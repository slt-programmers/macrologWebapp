<div class="page">
  <ml-navigation></ml-navigation>

  <div class="container flex gap-8 justify-center">
    <div class="card flex flex-col gap-4">
      <h1 class="text-lg font-bold">Log in</h1>

      <form [formGroup]="loginForm" class="flex flex-col gap-4">
        <div class="flex flex-col gap-1">
          <label for="usernameOrEmail"> Username or email </label>
          <input id="usernameOrEmail" type="text" formControlName="usernameOrEmail" />

          @if (loginForm.get('usernameOrEmail')!.touched &&
          loginForm.get('usernameOrEmail')!.invalid) {
          <span class="text-error text-sm">Username is required</span>
          }
        </div>

        <div class="flex flex-col gap-1">
          <label for="password"> Password </label>
          <input id="password" type="password" formControlName="password" />

          @if (loginForm.get('password')!.touched && loginForm.get('password')!.invalid) {
          <span class="text-error text-sm">Password is required</span>
          }
        </div>

        @if (loginError()) {
        <span class="text-error text-sm">{{loginError()}}</span>
        }

        <a id="forgotLink" (click)="toggleForgotPwModal(true)">Forgot password?</a>

        <button class="btn btn--primary" (click)="login()">Log in</button>
      </form>
    </div>

    <div class="card flex flex-col gap-4">
      <h1 class="text-lg font-bold">Register</h1>

      <form [formGroup]="registerForm" class="flex flex-col gap-4">
        <div class="flex flex-col gap-1">
          <label for="newUsername">Username</label>
          <input id="newUsername" type="text" formControlName="username" />

          @if (registerForm.get('username')!.touched && registerForm.get('username')!.invalid) {
          <span class="text-error text-sm">Username is required</span>
          }
        </div>

        <div class="flex flex-col gap-1">
          <label for="newEmal">Email</label>
          <input id="newEmail" type="email" formControlName="email" />

          @if (registerForm.get('email')!.touched && registerForm.get('email')!.invalid) {
          <span class="text-error text-sm">Email is required</span>
          }
        </div>

        <div class="flex flex-col gap-1">
          <label for="newPassword">Password</label>
          <input id="newPassword" type="password" formControlName="password" />

          @if (registerForm.get('password')!.touched && registerForm.get('password')!.invalid) {
          <span class="text-error text-sm">Password is required</span>
          }
        </div>

        @if (registerError()) {
        <span class="text-error text-sm">{{registerError()}}</span>
        }

        <button class="btn btn--primary" (click)="register()">Register </button>
      </form>
    </div>
  </div>
</div>

@if(showForgotPwModal()) {
<ml-modal [title]="'Forgot your password?'" (close$)="toggleForgotPwModal(false)">
  <form #forgotForm="ngForm" class="flex flex-col gap-4">
    <p>Please enter your email so we can send a link to reset your password</p>

    <div class="flex items-center gap-4">
      <label for="forgotEmail">Email</label>
      <input class="flex-grow" type="email" #forgotEmailField [(ngModel)]="forgotEmail"
        name="forgotEmail" />
    </div>

    @if (forgotError) {
    <p class="error">{{forgotError}}</p>
    }

    <button id="resetBtn" class="align-self-end btn btn--primary" [disabled]="forgotForm.invalid"
      (click)="resetPassword()">Send
    </button>
  </form>
</ml-modal>
}