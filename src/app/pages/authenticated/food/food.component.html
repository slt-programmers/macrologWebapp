<div class="content">
  <div class="card">
    <div class="content">
      <div class="flex align-center">
        <label for="search" class="search-bar__label">Search</label>
        <input id="seach" class="input search-bar__input" [(ngModel)]="searchInput"
          (input)="findFoodMatch()" />

        <button class="button button--primary" (click)="clearSearch()">
          Clear
        </button>
      </div>

      <div class="flex col-gap-1 align-center">
        <label>Display in</label>

        <div class="flex align-center">
          <input type="radio" id="grams" [(ngModel)]="displayMode" value="grams">
          <label for="grams">Grams</label>
        </div>

        <div class="flex align-center">
          <input type="radio" id="percentage" [(ngModel)]="displayMode" value="percentage">
          <label for="percentage">Percentage</label>
        </div>
      </div>

      <div class="spinner-wrapper" *ngIf="isLoading">
        <div class="spinner">
          <em class="fas fa-spinner"></em>
        </div>
      </div>

      <div *ngIf="!isLoading" class="food-table">
        <div class="table-header">
          <div class="table-header__name" (click)="sortBy('name')">Name</div>

          <div class="table-header__amount" *ngIf="displayMode === 'grams'">
            Amount
          </div>

          <div class="table-header__protein" [ngClass]="{
                'table-header__protein--percent': displayMode === 'percentage'
              }" (click)="sortBy('protein')">
            Protein
          </div>

          <div class="table-header__fat" [ngClass]="{
                'table-header__fat--percent': displayMode === 'percentage'
              }" (click)="sortBy('fat')">
            Fat
          </div>

          <div class="table-header__carbs" [ngClass]="{
                'table-header__carbs--percent': displayMode === 'percentage'
              }" (click)="sortBy('carbs')">
            Carbs
          </div>

          <div class="table-header__protein--mobile" [ngClass]="{
                'table-header__protein--percent': displayMode === 'percentage'
              }" (click)="sortBy('protein')">
            P
          </div>

          <div class="table-header__fat--mobile" [ngClass]="{
                'table-header__fat--percent': displayMode === 'percentage'
              }" (click)="sortBy('fat')">
            F
          </div>

          <div class="table-header__carbs--mobile" [ngClass]="{
                'table-header__carbs--percent': displayMode === 'percentage'
              }" (click)="sortBy('carbs')">
            C
          </div>
        </div>

        <div *ngIf="displayedFood">
          <div class="table-row" *ngFor="let food of displayedFood" (click)="openModal(food)">
            <div class="food">
              <div class="food__name">{{ food.name }}</div>

              <div class="food__amount" *ngIf="displayMode === 'grams'">
                {{ unitGrams }} {{ unitName }}
              </div>

              <div class="food__protein" [ngClass]="{
                    'food__protein--percent': displayMode === 'percentage'
                  }">
                {{ food.protein | number: '1.1-1' }}
              </div>

              <div class="food__fat" [ngClass]="{
                    'food__fat--percent': displayMode === 'percentage'
                  }">
                {{ food.fat | number: '1.1-1' }}
              </div>

              <div class="food__carbs" [ngClass]="{
                    'food__carbs--percent': displayMode === 'percentage'
                  }">
                {{ food.carbs | number: '1.1-1' }}
              </div>
            </div>

            <div class="portions" *ngIf="displayMode === 'grams'">
              <div class="portion" *ngFor="let portion of food.portions">
                <div class="portion__description">
                  <div class="portion__description--padded">
                    {{ portion.description }}
                  </div>
                </div>

                <div class="portion__amount" *ngIf="displayMode === 'grams'">
                  {{ portion.grams }} {{ unitName }}
                </div>

                <div class="portion__protein">
                  {{ portion.macros.protein | number: '1.1-1' }}
                </div>

                <div class="portion__fat">
                  {{ portion.macros.fat | number: '1.1-1' }}
                </div>

                <div class="portion__carbs">
                  {{ portion.macros.carbs | number: '1.1-1' }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="paginator flex flex-grow">
        <div class="previous flex-grow">
          <div *ngIf="currentPage > 1" (click)="getPagedFood({pageIndex: currentPage - 2})">
            <em class="fas fa-chevron-left"></em>
            Previous
          </div>
        </div>

        <div *ngIf="hasNextPage()" class="previous"
          (click)="getPagedFood({pageIndex: currentPage})">
          Next
          <em class="fas fa-chevron-right"></em>
        </div>
      </div>
    </div>
  </div>
</div>

<div class=" button-wrapper--floating-action">
  <button class="floating-action-button" (click)="openModal(null)">
    <em class="fas fa-plus"></em>
  </button>
</div>

<app-modal *ngIf="modalIsVisible" [title]="modalTitle" (close)="closeModal()">
  <form #saveFoodForm="ngForm">
    <div class="form-field">
      <label class="form-field__label">Food</label>
      <div class="form-field__element">
        <input class="input" [(ngModel)]="selectedFood.name" #foodField name="name"
          placeholder="e.g. 'Pasta', 'Apple'" required>
      </div>
    </div>

    <div class="form-field">
      <label class="form-field__label">Protein</label>
      <div class="form-field__element">
        <input class="input" #proteinField [(ngModel)]="selectedFood.protein" value="protein" name="protein"
          type="number" placeholder="0.0" step="0.1" required>
      </div>
    </div>

    <div class="form-field">
      <label class="form-field__label">Fat</label>
      <div class="form-field__element">
        <input class="input" #fatField [(ngModel)]="selectedFood.fat" name="fat" type="number" placeholder="0.0"
          step="0.1" required>
      </div>
    </div>

    <div class="form-field">
      <label class="form-field__label">Carbs</label>
      <div class="form-field__element">
        <input class="input" #carbsField [(ngModel)]="selectedFood.carbs" name="carbs" type="number"
          placeholder="0.0" step="0.1" required>
      </div>
    </div>

    <label class="">Frequently used portions (optional)</label>

    <div class="flex col-gap-2" *ngFor="let port of selectedFood.portions; index as i">
      <div class="flex-col flex-grow">

        <div class="form-field">
          <label class="form-field__label">Description</label>
          <input class="input" [(ngModel)]="port.description" name="portionDesc_{{i}}" type="text"
          placeholder="e.g. 'Breakfast', 'Plate'" required>
        </div>
        
        <div class="form-field">
          <label class="form-field__label">Grams</label>
          <input class="input" [(ngModel)]="port.grams" placeholder="0,0" name="portionGrams_{{i}}"
          type="number" step="1" required>
        </div>
      </div>

      <button class="icon-button" (click)="removePortion(i)" *ngIf="isNewPortion(port)">
        <em class="fas fa-minus"></em>
      </button>
    </div>

    <div>
      <button class="icon-button" (click)="addNewPortion()">
        <em class="fas fa-plus"></em>
      </button>
    </div>

    <div class="flex justify-end col-gap-1">
      <button class="button" (click)="closeModal()">Cancel</button>

      <button class="button button--primary" (click)="saveFood()"
        [disabled]="saveFoodForm.invalid">Save</button>
    </div>
  </form>
</app-modal>