<div class="content">
  @if (allDishes.length === 0) {
    <div class="dish-grid dish-grid--empty">
      <div class="card">
        <p>You havent created any dishes yet!</p>
      </div>
    </div>
  }

  @if (allDishes.length !== 0) {
    <div class="flex flex-wrap justify-center col-gap-1 row-gap-1">
      @for (dish of allDishes; track dish) {
        <div class="card" (click)="openModal(dish)">
          <div class="content">
            <h1 class="font-bold">{{ dish.name }}</h1>
            <div class="dish-card__content__pie-chart">
              <ml-piechart [mealId]="dish.id" [macros]="getTotal(dish)"></ml-piechart>
            </div>
            @for (ingredient of dish.ingredients; track ingredient) {
              <ul class="flex align-center col-gap-1">
                <li> {{ getIngredientDescription(ingredient) }} {{ ingredient.food.name }} </li>
              </ul>
            }
          </div>
        </div>
      }
    </div>
  }
</div>

<div class="button-wrapper--floating-action">
  <button class="floating-action-button" (click)="openModal(null)">
    <em class="fas fa-plus"></em>
  </button>
</div>

@if (modalIsVisible) {
  <ml-modal [title]="modalTitle" (close$)="closeModal()">
    <div class="min-w-32">
      <form #makeDishForm="ngForm" class="form">
        <div class="flex flex-col content">
          <div class="form-field">
            <label for="dishName">Name</label>
            <input class="input" [(ngModel)]="selectedDish.name" type="text" name="dishName"
              id="dishName" required>
            </div>
            @if (selectedDish.ingredients.length > 0) {
              <h1 class="font-semibold text-secondary">Ingredients</h1>
            }
            @for (ingr of selectedDish.ingredients; track ingr; let i = $index) {
              <div class="flex align-center col-gap-1"
                >
                <p class="flex-3">{{ingr.food.name}}</p>
                <div class="flex-2">
                  <select aria-label="portion" (change)="portionChange(ingr, $event.target)">
                    <!-- 100 grams -->
                    <option>{{unitName}}</option>
                    <!-- portion amount -->
                    @for (portion of ingr.food.portions; track portion) {
                      <option value="{{portion.description}}"
                        [selected]="portion.id === ingr.portion?.id">
                        {{portion.description}}
                      </option>
                    }
                  </select>
                </div>
                <div class="flex-1">
                  <input aria-label="amount" class="input" name="ingrAmount" type="number"
                    [value]="getValue(ingr)" (input)="calculateMultiplier($event, ingr)"
                    step="{{getStep(ingr)}}" min="0">
                  </div>
                  <div class="flex justify-end">
                    <button class="icon-button" (click)="removeIngredient(i)">
                      <em class="fas fa-trash"></em>
                    </button>
                  </div>
                </div>
              }
              <h1 class="text-secondary font-semibold">Add ingredients</h1>
              <div class="autocomplete-wrapper">
                <ml-autocomplete-food [placeholder]="'Search for food'" (select$)="addIngredient($event)">
                </ml-autocomplete-food>
              </div>
            </div>
            <div class="flex justify-end col-gap-1">
              @if (selectedDish) {
                <button class="button" (click)="deleteDish()">Delete</button>
              }
              <button class="button button--primary" [disabled]="makeDishForm.invalid"
              (click)="saveDish()">Save</button>
            </div>
          </form>
        </div>
      </ml-modal>
    }